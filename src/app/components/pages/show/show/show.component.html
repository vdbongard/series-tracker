<div *ngIf="show.tmdbShow" class="header">
  <img
    *ngIf="tmdbConfig"
    [src]="
      tmdbConfig.images.secure_base_url +
      tmdbConfig.images.poster_sizes[2] +
      show.tmdbShow.poster_path
    "
    [alt]="show.tmdbShow.name + ' Poster'"
    class="poster"
    loading="lazy"
  />
  <div>
    <h4 class="mat-subheading-1 small-text">
      {{ show.tmdbShow.status }} Â· {{ show.tmdbShow.networks[0].name }}
    </h4>
    <h2 class="mat-headline">{{ show.tmdbShow.name }}</h2>
    <p class="mat-body">{{ show.tmdbShow.overview }}</p>
  </div>
</div>

<div *ngIf="show.show && show.tmdbShow" class="next-episode">
  <ng-container *ngIf="show.nextEpisode && show.tmdbNextEpisode && tmdbConfig">
    <a
      class="mat-subheading-2 next-episode-text"
      [routerLink]="
        '/series/' +
        show.show.ids.slug +
        '/season/' +
        show.nextEpisode.season +
        '/episode/' +
        show.nextEpisode.number
      "
    >
      Next episode: S{{ show.nextEpisode.season | number: '2.0-0' }}E{{
        show.nextEpisode.number | number: '2.0-0'
      }}
      {{ show.nextEpisode.title }}
    </a>
    <app-episode
      [episode]="show.nextEpisode"
      [episodeProgress]="show?.showProgress?.seasons?.[show.nextEpisode.season]?.episodes?.[show.nextEpisode.number]"
      [tmdbEpisode]="show.tmdbNextEpisode"
      [imgPrefix]="tmdbConfig.images.secure_base_url + tmdbConfig.images.still_sizes[3]"
      (addToHistory)="addToHistory(show.nextEpisode, show.show)"
      (imgClick)="
        router.navigateByUrl(
          '/series/' +
            show.show.ids.slug +
            '/season/' +
            show.nextEpisode.season +
            '/episode/' +
            show.nextEpisode.number
        )
      "
    ></app-episode>
  </ng-container>

  <h3
    class="mat-subheading-2"
    *ngIf="!show.nextEpisode && !['Ended', 'Canceled'].includes(show.tmdbShow.status)"
  >
    No next episode
  </h3>
</div>

<mat-list *ngIf="show.show && show.showProgress">
  <mat-list-item
    *ngFor="let seasonProgress of show.showProgress.seasons"
    matRipple
    [routerLink]="'/series/' + show.show.ids.slug + '/season/' + seasonProgress.number"
  >
    <app-season-item [seasonProgress]="seasonProgress"></app-season-item>
  </mat-list-item>
</mat-list>

<mat-list *ngIf="show.tmdbShow && (!show || !show.showProgress)">
  <mat-list-item *ngFor="let season of show.tmdbShow.seasons | hideSeason0">
    <app-season-item [season]="season"></app-season-item>
  </mat-list-item>
</mat-list>
