<div *ngIf="tmdbShow" class="header">
  <img
    *ngIf="tmdbConfig && tmdbShow"
    [src]="
      tmdbConfig.images.secure_base_url + tmdbConfig.images.poster_sizes[2] + tmdbShow.poster_path
    "
    [alt]="tmdbShow.name + ' Poster'"
    class="poster"
    loading="lazy"
  />
  <div>
    <h4 class="mat-subheading-1 small-text">
      {{ tmdbShow.status }} Â· {{ tmdbShow.networks[0].name }}
    </h4>
    <h2 class="mat-headline">{{ tmdbShow.name }}</h2>
    <p class="mat-body">{{ tmdbShow.overview }}</p>
  </div>
</div>

<div *ngIf="showProgress && ids && tmdbShow" class="next-episode">
  <ng-container
    *ngIf="showProgress.next_episode && nextEpisode && tmdbNextEpisode && slug && tmdbConfig"
  >
    <a
      class="mat-subheading-2 next-episode-text"
      [routerLink]="
        '/series/' + this.slug + '/season/' + nextEpisode.season + '/episode/' + nextEpisode.number
      "
    >
      Next episode: S{{ nextEpisode.season | number: '2.0-0' }}E{{
        nextEpisode.number | number: '2.0-0'
      }}
      {{ nextEpisode.title }}
    </a>
    <app-episode
      [episode]="nextEpisode"
      [episodeProgress]="
        showProgress.seasons[showProgress.next_episode.season - 1]?.episodes?.[
          showProgress.next_episode.number - 1
        ]
      "
      [tmdbEpisode]="tmdbNextEpisode"
      [imgPrefix]="tmdbConfig.images.secure_base_url + tmdbConfig.images.still_sizes[3]"
      (addToHistory)="syncService.syncAddToHistory(nextEpisode, ids)"
      (removeFromHistory)="syncService.syncRemoveFromHistory(nextEpisode, ids)"
      (imgClick)="
        router.navigateByUrl(
          '/series/' +
            this.slug +
            '/season/' +
            nextEpisode.season +
            '/episode/' +
            nextEpisode.number
        )
      "
    ></app-episode>
  </ng-container>

  <h3
    class="mat-subheading-2"
    *ngIf="!showProgress.next_episode && !['Ended', 'Canceled'].includes(tmdbShow.status)"
  >
    No next episode
  </h3>
</div>

<mat-list *ngIf="slug && showProgress">
  <mat-list-item
    *ngFor="let seasonProgress of showProgress.seasons"
    matRipple
    [routerLink]="'/series/' + slug + '/season/' + seasonProgress.number"
  >
    <app-season-item [seasonProgress]="seasonProgress"></app-season-item>
  </mat-list-item>
</mat-list>

<mat-list *ngIf="slug && tmdbShow && !showProgress">
  <mat-list-item *ngFor="let season of tmdbShow.seasons | hideSeason0">
    <app-season-item [season]="season"></app-season-item>
  </mat-list-item>
</mat-list>
