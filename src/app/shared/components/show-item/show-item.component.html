<img
  *ngIf="imgPrefix && tmdbShow && tmdbShow.poster_path && show"
  [src]="imgPrefix + tmdbShow.poster_path"
  [alt]="tmdbShow.name + ' Poster'"
  class="poster"
  loading="lazy"
/>
<img
  *ngIf="!(imgPrefix && tmdbShow && tmdbShow.poster_path && show)"
  src="assets/poster.png"
  alt="No poster"
  class="poster"
  loading="lazy"
/>
<div class="right" [class.without-gap]="!withRightButtons">
  <div class="left-wrapper">
    <p *ngIf="progress || tmdbShow" class="mat-small small-text">
      <ng-container *ngIf="withEpisodesCount">
        <ng-container *ngIf="tmdbShow && (!progress || progress.completed === 0)">
          {{ tmdbShow.number_of_episodes }} episodes
        </ng-container>
        <ng-container
          *ngIf="progress && progress.completed > 0 && progress.aired - progress.completed"
        >
          {{ progress.aired - progress.completed }} remaining
        </ng-container>
        <ng-container
          *ngIf="tmdbShow && (!progress || (progress && progress.aired - progress.completed))"
        >
          Â·
        </ng-container>
      </ng-container>
      {{ tmdbShow?.networks?.[0]?.name }}
    </p>

    <div class="title-wrapper" *ngIf="show">
      <h2 class="mat-title title">{{ show.title }}{{ withYear && ' (' + show.year + ')' }}</h2>
      <ng-container *ngIf="favorite !== undefined">
        <button
          *ngIf="favorite"
          mat-icon-button
          aria-label="Favorite"
          class="favorite-button"
          (click)="$event.stopPropagation(); removeFavorite.emit(show.ids.trakt)"
        >
          <mat-icon class="favorite-icon">star</mat-icon>
        </button>
        <button
          *ngIf="!favorite"
          mat-icon-button
          aria-label="Favorite"
          class="favorite-button remove"
          (click)="$event.stopPropagation(); addFavorite.emit(show.ids.trakt)"
        >
          <mat-icon class="favorite-icon">star_outline</mat-icon>
        </button>
      </ng-container>
    </div>

    <mat-progress-bar
      *ngIf="progress"
      class="progress-bar"
      mode="determinate"
      [value]="(progress.completed / progress.aired) * 100"
    ></mat-progress-bar>

    <ng-container *ngIf="withNextEpisode && nextEpisode">
      <p class="mat-small next-episode-text">
        S{{ nextEpisode.season | number: '2.0-0' }}E{{ nextEpisode.number | number: '2.0-0' }}
        {{ nextEpisode.title }}
      </p>
      <p class="mat-small next-episode-date">
        {{ nextEpisode.first_aired | date: 'd. MMM. yyyy (E.)' }}
      </p>
      <p
        *ngIf="
          !nextEpisode &&
          !progress?.next_episode &&
          tmdbShow &&
          !['Ended', 'Canceled'].includes(tmdbShow.status)
        "
      >
        No next episode
      </p>
    </ng-container>
  </div>

  <div *ngIf="withRightButtons && show">
    <button *ngIf="progress" mat-icon-button aria-label="Show added" disabled>
      <mat-icon>checkbox</mat-icon>
    </button>
    <button
      *ngIf="!progress"
      mat-icon-button
      aria-label="Add show"
      (click)="$event.stopPropagation(); addShow.emit(show.ids)"
    >
      <mat-icon>add</mat-icon>
    </button>
  </div>
</div>
