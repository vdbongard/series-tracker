<mat-toolbar class="toolbar">
  <a routerLink="/" class="logo">SeriesTracker</a>
  <mat-spinner
    *ngIf="syncService.isSyncing | async"
    class="syncing-spinner"
    diameter="24"
  ></mat-spinner>
  <span class="spacer"></span>
  <span *ngIf="isLoggedIn">
    <button mat-icon-button aria-label="Search icon" routerLink="/search">
      <mat-icon>search</mat-icon>
    </button>
    <ng-container *ngIf="router.url === '/'">
      <button mat-icon-button aria-label="Filter icon" [matMenuTriggerFor]="menuFilter">
        <mat-icon>filter_alt</mat-icon>
      </button>
      <button mat-icon-button aria-label="Sort icon" [matMenuTriggerFor]="menuSort">
        <mat-icon>sort</mat-icon>
      </button>
    </ng-container>
  </span>
  <button mat-icon-button aria-label="Open menu" [matMenuTriggerFor]="menu">
    <mat-icon>more_vert</mat-icon>
  </button>
</mat-toolbar>

<nav *ngIf="activeLink" mat-tab-nav-bar [tabPanel]="tabPanel">
  <a
    mat-tab-link
    *ngFor="let link of links"
    (click)="router.navigateByUrl(link.url); activeLink = link"
    [active]="activeLink === link"
  >
    {{ link.name }}
  </a>
</nav>

<mat-tab-nav-panel #tabPanel>
  <router-outlet></router-outlet>
</mat-tab-nav-panel>

<mat-menu #menuFilter="matMenu">
  <section class="section" (click)="$event.stopPropagation()">
    <h4 class="list-title">Hide</h4>

    <ul class="list" *ngIf="config">
      <li class="list-item" *ngFor="let filter of config.filters">
        <mat-checkbox [(ngModel)]="filter.value" (ngModelChange)="syncService.syncConfig()">
          {{ filter.name }}
        </mat-checkbox>
      </li>
    </ul>
  </section>
</mat-menu>

<mat-menu #menuSort="matMenu">
  <section class="section" (click)="$event.stopPropagation()">
    <h4 class="list-title">Sort</h4>

    <mat-radio-group
      *ngIf="config"
      class="radio-group"
      [(ngModel)]="config.sort.by"
      (ngModelChange)="syncService.syncConfig()"
    >
      <mat-radio-button
        *ngFor="let sortBy of config.sort.values"
        [value]="sortBy"
        class="radio-button"
      >
        {{ sortBy }}
      </mat-radio-button>
    </mat-radio-group>
    <ul *ngIf="config" class="list">
      <li
        class="list-item"
        *ngFor="let sortOption of config.sortOptions"
        [value]="sortOption.value"
      >
        <mat-checkbox [(ngModel)]="sortOption.value" (ngModelChange)="syncService.syncConfig()">
          {{ sortOption.name }}
        </mat-checkbox>
      </li>
    </ul>
  </section>
</mat-menu>

<mat-menu #menu="matMenu">
  <button mat-menu-item [matMenuTriggerFor]="themes">
    <mat-icon>palette</mat-icon>
    <span>Themes</span>
  </button>
  <button mat-menu-item (click)="appStatus.checkForUpdate()">
    <mat-icon>update</mat-icon>
    <span>Check for updates</span>
  </button>
  <button *ngIf="isLoggedIn" mat-menu-item (click)="logout()">
    <mat-icon>logout</mat-icon>
    <span>Logout</span>
  </button>
</mat-menu>

<mat-menu #themes="matMenu">
  <button mat-menu-item (click)="configService.setTheme(theme.LIGHT); syncService.syncConfig()">
    Light
  </button>
  <button mat-menu-item (click)="configService.setTheme(theme.DARK); syncService.syncConfig()">
    Dark
  </button>
  <button mat-menu-item (click)="configService.setTheme(theme.SYSTEM); syncService.syncConfig()">
    System
  </button>
</mat-menu>
